@model NhaSach.Web.ViewModels.HomeIndexVm
@{
    ViewData["Title"] = "Trang chủ";
}

<!-- SẢN PHẨM MỚI -->
<h2 class="mb-3 d-flex justify-content-between align-items-center">
    <span>Sản phẩm mới</span>
    <a class="btn btn-sm btn-outline-primary" asp-controller="CuaHang" asp-action="Index">Xem tất cả</a>
</h2>
<div class="row g-3">
    @if (Model.SanPhamMoi?.Count > 0)
    {
        foreach (var sp in Model.SanPhamMoi)
        {
            <div class="col-6 col-md-3">
                @await Html.PartialAsync("_SanphamCard", sp)
            </div>
        }
    }
    else
    {
        <div class="col-12">
            <div class="text-muted">Chưa có sản phẩm mới.</div>
        </div>
    }
</div>

<!-- SẢN PHẨM NỔI BẬT -->
<hr class="my-4" />
<h2 class="mb-3 d-flex justify-content-between align-items-center">
    <span>Sản phẩm nổi bật</span>
    <a class="btn btn-sm btn-outline-primary" asp-controller="CuaHang" asp-action="Index" asp-route-sort="bestseller">Xem tất cả</a>
</h2>
<div class="row g-3">
@if (Model.SanPhamNoiBat?.Count > 0)
{
    @for (int i = 0; i < Model.SanPhamNoiBat.Count; i++)
    {
        var sp = Model.SanPhamNoiBat[i];
        var rank = i < 3 ? i + 1 : (int?)null;   // chỉ 1..3

        <div class="col-6 col-md-3">
            @await Html.PartialAsync(
                "_SanphamCard",
                sp,
                new ViewDataDictionary(ViewData) { { "Rank", rank } }
            )
        </div>
    }
}
else
{
    <div class="col-12"><div class="text-muted">Chưa có sản phẩm nổi bật.</div></div>
}
</div>

<!-- SẢN PHẨM KHUYẾN MÃI -->
<hr class="my-4" />
<h2 class="mb-3 d-flex justify-content-between align-items-center">
    <span>Khuyến mãi</span>
    <a class="btn btn-sm btn-outline-primary" asp-controller="CuaHang" asp-action="Index" asp-route-onlyPromo="true">Xem tất cả</a>
</h2>
<div class="row g-3">
    @if (Model.SanPhamKhuyenMai?.Count > 0)
    {
        foreach (var sp in Model.SanPhamKhuyenMai)
        {
            <div class="col-6 col-md-3">
                @await Html.PartialAsync("_SanphamCard", sp)
            </div>
        }
    }
    else
    {
        <div class="col-12">
            <div class="text-muted">Hiện chưa có chương trình khuyến mãi.</div>
        </div>
    }
</div>

<!-- BÀI VIẾT MỚI -->
<hr class="my-4" />
<h2 class="mb-3">Bài viết mới</h2>
<div class="row g-3">
    @if (Model.BaiVietMoi?.Count > 0)
    {
        foreach (var bv in Model.BaiVietMoi)
        {
            <div class="col-12 col-md-4">
                @await Html.PartialAsync("_BaivietCard", bv)
            </div>
        }
    }
    else
    {
        <div class="col-12"><div class="text-muted">Chưa có bài viết.</div></div>
    }
</div>

<!-- SỰ KIỆN -->
<hr class="my-4" />
<h2 class="mb-3">Sự kiện sắp tới</h2>
<ul class="list-group">
    @if (Model.SuKien?.Count > 0)
    {
        foreach (var sk in Model.SuKien)
        {
            @await Html.PartialAsync("_SukienItem", sk)
        }
    }
    else
    {
        <li class="list-group-item text-muted">Chưa có sự kiện.</li>
    }
</ul>