@{
    ViewData["Title"] = "Tài khoản";
    var returnUrl = (ViewBag.ReturnUrl as string);
    if (string.IsNullOrEmpty(returnUrl) || returnUrl.Contains("/Taikhoan/Index"))
    {
        returnUrl = "/";
    }
}
<h2 class="mb-3">Tài khoản</h2>

@if (TempData["Error"] is string err && !string.IsNullOrWhiteSpace(err))
{
    <div class="alert alert-danger white-space-pre-line">@err</div>
}

@if (!(User?.Identity?.IsAuthenticated ?? false))
{
    <ul class="nav nav-tabs" id="accountTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab">Đăng nhập</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab">Đăng ký</button>
        </li>
    </ul>

    <div class="tab-content mt-3">
        <!-- Đăng nhập -->
        <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
            <form asp-action="DangNhap" method="post" class="row g-3">
                @Html.AntiForgeryToken()
                <input type="hidden" name="ReturnUrl" value="@returnUrl" />
                <div class="col-12">
                    <label class="form-label">Email</label>
                    <input name="Email" type="email" class="form-control" required />
                </div>
                <div class="col-12">
                    <label class="form-label">Mật khẩu</label>
                    <input name="Password" type="password" class="form-control" required />
                </div>
                <div class="col-12 form-check">
                    <input class="form-check-input" type="checkbox" name="GhiNho" id="remember" />
                    <label class="form-check-label" for="remember">Ghi nhớ</label>
                </div>
                <div class="col-12">
                    <button class="btn btn-primary" type="submit">Đăng nhập</button>
                </div>
            </form>
        </div>

        <!-- Đăng ký -->
        <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
            <form asp-action="DangKy" method="post" class="row g-3">
                @Html.AntiForgeryToken()
                <div class="col-12">
                    <label class="form-label">Email</label>
                    <input name="Email" type="email" class="form-control" required />
                </div>
                <div class="col-12">
                    <label class="form-label">Họ và tên</label>
                    <input name="HoTen" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Mật khẩu</label>
                    <input name="Password" type="password" class="form-control" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Nhập lại mật khẩu</label>
                    <input name="ConfirmPassword" type="password" class="form-control" required />
                </div>
                <div class="col-12">
                    <button class="btn btn-success" type="submit">Đăng ký</button>
                </div>
            </form>
        </div>
    </div>
}
else
{
    <div class="card">
        <div class="card-body">
            <p>Bạn đang đăng nhập: <strong>@User.Identity!.Name</strong></p>
            <form asp-action="DangXuat" method="post">
                @Html.AntiForgeryToken()
                <button class="btn btn-danger">Đăng xuất</button>
            </form>
        </div>
    </div>
}
